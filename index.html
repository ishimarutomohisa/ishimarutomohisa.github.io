<!doctype html>  
<html lang="zh">  
<head>  
<meta charset="utf-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />  
<link rel="icon" href="https://static.wikia.nocookie.net/disneymagicalkingdoms/images/e/ea/Update-16-app_icon.png" type="image/png">
<title>Disney Magic Kingdoms Update 101</title>  
<!-- Highcharts Gantt CDN -->  
<script src="https://code.highcharts.com/gantt/highcharts-gantt.js"></script>  
<style>  
  :root {  
    --primary-blue: #1976d2;  
    --bg-color: #f0f2f5;  
    --card-bg: #ffffff;  
  }  
  
  body {   
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;  
    margin: 0;  
    padding: 20px;  
    background: var(--bg-color);  
    color: #333;  
    /* å…è®¸é¡µé¢å‚ç›´æ»šåŠ¨ */  
    min-height: 100vh;  
    display: flex;  
    justify-content: center;  
    align-items: flex-start; /* æ”¹ä¸ºé¡¶éƒ¨å¯¹é½ï¼Œé˜²æ­¢é•¿å†…å®¹åˆ‡æ–­ */  
  }  
    
  /* ä¸»å¡ç‰‡å®¹å™¨ */  
  .main-container {  
    background: var(--card-bg);  
    width: 100%;  
    max-width: 1000px; /*åœ¨å¤§å±ä¸Šé™åˆ¶æœ€å¤§å®½åº¦ */  
    border-radius: 12px;  
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);  
    padding: 24px;  
    box-sizing: border-box;  
    display: flex;  
    flex-direction: column;  
  }  
    
  /* å¤´éƒ¨æ ‡é¢˜åŒºåŸŸ */  
  h1 {   
    display: flex;   
    flex-wrap: wrap; /* å…è®¸å°å±æ¢è¡Œ */  
    align-items: center;   
    gap: 12px;   
    margin: 0 0 16px 0;  
  }  
    
  .outline-effect {  
    color: #207CE2;  
    text-shadow: 1px 1px 0 #fff, 2px 2px 4px rgba(30, 58, 138, 0.3);  
    font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;  
    font-size: clamp(20px, 4vw, 32px); /* å“åº”å¼å­—ä½“ */  
    margin-right: auto;  
  }  
    
  /* æŒ‰é’®ç»„ */  
  .btn-group {  
    display: flex;  
    gap: 8px;  
    flex-wrap: wrap;  
  }  
  
  h1 button {  
    background: var(--primary-blue);  
    color: #fff;  
    border: none;  
    border-radius: 6px;  
    padding: 8px 16px;  
    font-size: 14px;  
    cursor: pointer;  
    white-space: nowrap;  
    transition: background 0.2s;  
  }  
    
  h1 button:hover {  
    background: #1565c0;  
  }  
  
  .note {   
    color: #666;   
    font-size: 14px;   
    margin-bottom: 12px;   
    background: #fff8e1;  
    padding: 8px 12px;  
    border-radius: 4px;  
    border-left: 4px solid #ffc107;  
  }  
    
  /* é¡¶éƒ¨å›¾ç‰‡ */  
  .top-image {   
    width: 100%;  
    height: auto;  
    display: block;  
    border-radius: 8px;  
    margin-bottom: 20px;  
  }  
    
  /* --- æ ¸å¿ƒä¿®æ”¹ï¼šå›¾è¡¨æ»šåŠ¨å®¹å™¨ --- */  
  .chart-wrapper {  
    width: 100%;  
    overflow-x: auto; /* å…è®¸æ¨ªå‘æ»šåŠ¨ */  
    -webkit-overflow-scrolling: touch; /* iOS å¹³æ»‘æ»šåŠ¨ */  
    border: 1px solid #eee;  
    border-radius: 6px;  
    background: #fff;  
    /* æ»šåŠ¨æ¡æ ·å¼ */  
    padding-bottom: 4px;   
  }  
    
  .chart-wrapper::-webkit-scrollbar {  
    height: 8px;  
  }  
  .chart-wrapper::-webkit-scrollbar-thumb {  
    background: #ccc;  
    border-radius: 4px;  
  }  
  
  /* å›¾è¡¨æœ¬ä½“ */  
  #container {   
    height: auto;   
    /* å…³é”®ï¼šè®¾ç½®æœ€å°å®½åº¦ï¼Œå¼ºåˆ¶åœ¨å°å±ä¸Šå‡ºç°æ»šåŠ¨æ¡ï¼Œé˜²æ­¢å†…å®¹æŒ¤å‹ */  
    min-width: 800px;   
    margin: 0;   
    padding: 0;  
  }  
  
  /* ç§»åŠ¨ç«¯é€‚é… */  
  @media (max-width: 600px) {  
    body { padding: 10px; }  
    .main-container { padding: 15px; }  
    h1 { flex-direction: column; align-items: flex-start; }  
    .btn-group { width: 100%; }  
    h1 button { flex: 1; text-align: center; }  
  }  
</style>  
</head>  
<body>  
  <div class="main-container">  
    <h1>  
      <span id="headerTitle" class="outline-effect">DMK Update 101</span>  
      <div class="btn-group">  
        <button id="btnPatch">Patch Note</button>  
        <button id="btnWiki">Wiki</button>  
        <button onclick="window.open('https://www.facebook.com/DisneyMagicKingdoms')">Facebook</button>  
        <button onclick="window.open('https://discord.com/channels/981942496630304818/1288901443511910511')">Discord</button>  
        <button onclick="window.open('https://github.com/ishimarutomohisa/ishimarutomohisa.github.io/edit/main/index.html')">Github</button>  
      </div>  
    </h1>  
      
    <div class="note">âš ï¸ Dreamsparks will not be available in UP101, most probably in UP103.</div>  
      
    <img id="topImage" class="top-image"  
         src="https://dmk.assets.gameloft.com/assets/UPD_101_Pack_Art_Avatar_full_6416x2484_Full_1_ac668e4c4c.jpg"  
         alt="Disney Magic Kingdoms Artwork"   
         onerror="this.style.display='none'" />  
      
    <!-- å¢åŠ äº†ä¸€å±‚ wrapper ç”¨äºæ»šåŠ¨ -->  
    <div class="chart-wrapper">  
      <div id="container"></div>  
    </div>  
  </div>  
  
<script>  
// ==========================================  
// 0. å…¨å±€é…ç½® (ä¿®æ”¹è¿™é‡Œå³å¯æ›´æ–°ç‰ˆæœ¬)  
// ==========================================  
const CONFIG = {  
  version: '101', // ğŸ› ï¸ åªéœ€è¦æ”¹è¿™ä¸ªæ•°å­—ï¼Œæ‰€æœ‰é“¾æ¥å’Œæ ‡é¢˜éƒ½ä¼šè‡ªåŠ¨æ›´æ–°  
};  

// ==========================================  
// 1. åˆå§‹åŒ–é¡µé¢å†…å®¹ (æ ‡é¢˜ã€é“¾æ¥)  
// ==========================================  
(function initPageContent() {  
  const v = CONFIG.version;  
    
  // 1. æ›´æ–°ç½‘é¡µ <title>  
  document.title = `Disney Magic Kingdoms Update ${v}`;  
    
  // 2. æ›´æ–°é¡µé¢å¤§æ ‡é¢˜æ–‡æœ¬  
  const headerTitle = document.getElementById('headerTitle');  
  if (headerTitle) headerTitle.innerText = `DMK Update ${v}`;  
    
  // 3. ç»‘å®š Patch Note æŒ‰é’®é“¾æ¥  
  const btnPatch = document.getElementById('btnPatch');  
  if (btnPatch) {  
    btnPatch.onclick = function() {  
      window.open(`https://www.disney-magic-kingdoms.com/news/patchnote_upd${v}`);  
    };  
  }  
    
  // 4. ç»‘å®š Wiki æŒ‰é’®é“¾æ¥  
  const btnWiki = document.getElementById('btnWiki');  
  if (btnWiki) {  
    btnWiki.onclick = function() {  
      window.open(`https://dmk.fandom.com/wiki/Category:Update_${v}`);  
    };  
  }  
})();  

// ==========================================  
// 2. å›¾ç‰‡åŠ è½½è¶…æ—¶æ§åˆ¶é€»è¾‘ (æ–°å¢éƒ¨åˆ†)  
// ==========================================  
(function handleImageLoading() {  
  const img = document.getElementById('topImage');  
  const timeoutDuration = 5000; // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š5000æ¯«ç§’ (5ç§’)  
  
  // å¦‚æœè„šæœ¬æ‰§è¡Œæ—¶å›¾ç‰‡å·²ç»åŠ è½½å®Œäº†ï¼ˆæ¯”å¦‚æ¥è‡ªç¼“å­˜ï¼‰ï¼Œç›´æ¥è¿”å›  
  if (img.complete) return;  
  
  // è®¾ç½®å®šæ—¶å™¨  
  const timer = setTimeout(() => {  
    // å†æ¬¡æ£€æŸ¥ï¼Œå¦‚æœè¿˜æ²¡å®Œæˆ  
    if (!img.complete) {  
      console.warn('Image loading timed out (' + timeoutDuration + 'ms). Hiding image.');  
      img.src = ''; // ç½®ç©º src åœæ­¢ç½‘ç»œè¯·æ±‚  
      img.style.display = 'none'; // éšè—å…ƒç´   
      img.style.marginBottom = '0'; // å»é™¤ä¸‹è¾¹è·  
    }  
  }, timeoutDuration);  
  
  // å¦‚æœåŠ è½½æˆåŠŸï¼Œæ¸…é™¤å®šæ—¶å™¨  
  img.onload = () => clearTimeout(timer);  
    
  // å¦‚æœåŠ è½½æœ¬èº«å°±æŠ¥é”™ï¼ˆ404ç­‰ï¼‰ï¼Œæ¸…é™¤å®šæ—¶å™¨å¹¶éšè—  
  img.onerror = () => {  
    clearTimeout(timer);  
    img.style.display = 'none';  
  };  
})();  

// ==========================================  
// 3. Highcharts ç”˜ç‰¹å›¾é€»è¾‘  
// ==========================================  
const schedules = [  
  {  
    resource: '',  
    tasks: [  
      {start: '2025-12-10', end: '2025-12-14', label: 'Virus'},  
    ]  
  },  
  {  
    resource: '',  
    tasks: [  
      {start: '2025-12-11', end: '2025-12-14', label: 'Storm Cloud'},  
    ]  
  },  
  {  
    resource: '',  
    tasks: [  
      {start: '2025-12-24', end: '2025-12-29', label: 'Dreamland Quest'},  
    ]  
  },  
  {  
    resource: '',  
    tasks: [  
      {start: '2025-12-15', end: '2026-01-05', label: 'Avatar â€“ Mega Event'},  
      {start: '2025-12-15', end: '2025-12-18', label: 'Chapter 1'},  
      {start: '2025-12-18', end: '2025-12-24', label: 'Chapter 2'},  
      {start: '2025-12-24', end: '2025-12-31', label: 'Chapter 3'},  
      {start: '2025-12-31', end: '2026-01-05', label: 'Chapter 4'},  
      {start: '2025-12-18', end: '2025-12-21', label: 'Striking Gold'},  
      {start: '2025-12-25', end: '2025-12-28', label: 'Striking Gold'},  
      {start: '2026-01-01', end: '2026-01-04', label: 'Striking Gold'},  
    ]  
  }  
];  
  
const colors = ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#F44336', '#3F51B5', '#00BCD4'];  
  
function toUtcMs(ymd) {  
  const parts = ymd.split('-').map(Number);  
  return Date.UTC(parts[0], parts[1]-1, parts[2], 23);  
}  
  
function endToUtcMsInclusive(ymd) {  
  const parts = ymd.split('-').map(Number);  
  return Date.UTC(parts[0], parts[1]-1, parts[2], 23);  
}  
  
function computeLanesForTasks(tasks) {  
  const sorted = tasks.slice().sort((a,b) => a.start.localeCompare(b.start));  
  const lanes = [];  
  for (const t of sorted) {  
    let placed = false;  
    const sA = toUtcMs(t.start);  
    const eA = endToUtcMsInclusive(t.end);  
    for (const lane of lanes) {  
      const last = lane[lane.length - 1];  
      const sB = toUtcMs(last.start);  
      const eB = endToUtcMsInclusive(last.end);  
      if (sA >= eB) {  
        lane.push(t);  
        placed = true;  
        break;  
      }  
    }  
    if (!placed) lanes.push([t]);  
  }  
  return lanes;  
}  
  
const categories = [];  
const plotBands = [];  
const seriesData = [];  
let globalLaneIndex = 0;  
let colorIdx = 0;  
  
for (let r = 0; r < schedules.length; r++) {  
  const res = schedules[r];  
  const lanes = computeLanesForTasks(res.tasks);  
  
  const startLane = globalLaneIndex;  
  const endLane = globalLaneIndex + lanes.length - 1;  
  plotBands.push({  
    from: startLane - 0.5,  
    to: endLane + 0.5,  
    color: (r % 2 === 0) ? 'rgba(250,250,250,0.9)' : 'rgba(245,245,255,0.95)',  
    label: {  
      align: 'left',  
      x: 6,  
      y: 6,  
      style: { color: '#666', fontSize: '12px' }  
    }  
  });  
  
  for (let li = 0; li < lanes.length; li++) {  
    categories.push(li === 0 ? res.resource : '');  
    for (const t of lanes[li]) {  
      seriesData.push({  
        id: `${res.resource}_${t.label}_${Math.random().toString(36).slice(2,8)}`,  
        name: t.label,  
        start: toUtcMs(t.start),  
        end: endToUtcMsInclusive(t.end),  
        y: globalLaneIndex,  
        color: colors[(colorIdx++) % colors.length],  
        custom: { resource: res.resource }  
      });  
    }  
    globalLaneIndex++;  
  }  
}  
  
const minStartMs = Math.min(...seriesData.map(d => d.start));  
const xAxisMin = minStartMs - (24*3600*1000);  
const nowMs = Date.now() + 8*3600*1000;  
  
Highcharts.ganttChart('container', {  
  chart: {  
    height: Math.max(300, categories.length * 28 + 100), // ç•¥å¾®è°ƒæ•´é«˜åº¦è®¡ç®—  
    style: { fontFamily: 'inherit' }  
  },  
  tooltip: {  
  enabled: false,
    pointFormatter: function () {  
      const p = this;  
      const s = new Date(p.start), e = new Date(p.end);  
      const fmt = d => d.getUTCFullYear() + '-' + String(d.getUTCMonth()+1).padStart(2,'0') + '-' + String(d.getUTCDate()).padStart(2,'0');  
      return '';//`<b>${p.name}</b><br/>å¼€å§‹ï¼š${fmt(s)}<br/>ç»“æŸï¼š${fmt(new Date(p.end - 1))}`;  
    },  
    headerFormat: ''  
  },  
  xAxis: [{  
    min: xAxisMin,  
    tickInterval: 24 * 3600 * 1000,  
    labels: {  
      format: '{value:%d}',  
      style: { color: '#333', fontSize: '12px' }  
    },  
    plotLines: [{  
      value: nowMs,  
      color: '#FF3B30',  
      width: 2,  
      dashStyle: 'ShortDash',  
      zIndex: 3,  
      label: { rotation: 0, x: 9, y: -4, text: 'ï¸ğŸ”»', align: 'right', style: { color: '#FF3B30' } }  
    }, {  
      value: toUtcMs('2025-12-25'),  
      color: '#30C2FF',  
      width: 2,  
      dashStyle: 'ShortDash',  
      zIndex: 2,  
      label: { rotation: 0, x: 9, y: -4, text: 'ğŸ', align: 'right' }  
    }]  
  }],  
  yAxis: {  
    categories: categories,  
    reversed: true,  
    grid: { enabled: true, borderColor: '#eee' },  
    labels: { enabled: false },  
    plotBands: plotBands,  
    tickLength: 0  
  },  
  series: [{  
    name: 'ä»»åŠ¡',  
    data: seriesData,  
    dataLabels: {  
      enabled: true,  
      format: '{point.name}', // ç›´æ¥æ˜¾ç¤ºåå­—   
      allowOverlap: true,     // å…è®¸æ–‡å­—é‡å ï¼ˆé˜²æ­¢è¢«è‡ªåŠ¨éšè—ï¼‰  
      padding: 0,  
      style: {   
        color: '#fff',   
        textOutline: '2px #000000', // å…³é”®ï¼šé»‘è‰²æè¾¹ï¼Œç¡®ä¿åœ¨äº®è‰²æ¡ä¸Šä¹Ÿçœ‹å¾—æ¸…  
        fontWeight: 'bold',  
        fontSize: '11px',  
        textOverflow: 'none' // ä¸æ˜¾ç¤ºçœç•¥å·ï¼Œå°½é‡æ˜¾ç¤ºå…¨æ–‡  
      }  
    },  
    borderRadius: 3,  
    borderWidth: 0  
  }],  
  exporting: { enabled: true },  
  credits: { enabled: false }  
});  
</script>  
</body>  
</html>  

